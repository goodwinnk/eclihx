# Introduction #

This page briefly explains how to build the update site for EclihX. The update site is available at http://eclihx.googlecode.com/svn/trunk/updates/.

The building of EclihX is a manual process to be performed on a developer's machine using the Eclipse Plugin Development Environment. That's because Google Code does not offer shell access, cron jobs, or nightly build, and because no other server is available for EclihX development.

Steps on how to perform this process are detailed below.


# Recommended Readings #

The following resources need to be understood before any of the following can make sense.

  1. [Eclipse version numbering explained](http://wiki.eclipse.org/index.php/Version_Numbering): **we should stick to these conventions**
  1. [Qualifier generation during the build process](http://help.eclipse.org/galileo/index.jsp?topic=/org.eclipse.pde.doc.user/tasks/pde_version_qualifiers.htm): explains how a plugin version of '0.1.0.qualifier' works. The qualifier makes it possible to trigger client updates with a new build and not just when the version increases.
  1. [Eclipse FAQ on creating an update site](http://wiki.eclipse.org/FAQ_How_do_I_create_an_update_site_(site.xml)%3F): a very quick overview of how to create an update site.

# Build Setup and Overview #

The 'updates' directory in trunk serves two purposes:
  1. it contains the files for the update site itself: all the jars go in there
  1. it contains the eclipse project for building the update site (site.xml and .project file)

Therefore the 'updates' directory must be imported into the eclipse workspace as a project on its own along the other plugin and feature projects that reside under trunk.

EclihX is organized into several plugins that are bundled into one single feature plugin (eclihx.feature). The update site references the eclihx.feature, which itself references all the other plugins. Plugin and feature jars are generated during the site build process and placed into the plugins and features directories. At the root of the update site two other jars are generated: contents.jar and artifacts.jar. These are 'internals' to P2 (the eclipse software update component) and can only be generated by the site build process. The site.xml file is the only configuration file that drives the build process. Its content can be edited through a form-based multi-page site manifest editor that manages the site.xml file and builds an update site.

The update site build process is triggered via the _Build All_ button from the site.xml editor. During the build all the necessary jars are generated.

# Build process #

## 1. Preliminary steps ##
  1. **Check import statements**
> > Make sure no unnecessary imports are left in your code which could cause improper plugin dependencies. The best way to do this is to right-click in the source editor and select _Source > Organize Imports_ (_Shift+Ctrl+O_)
  1. **Review plugin manifest**
> > A quick way to check that all dependencies listed by your plug-in are actually used by the plug-in is to run the _Find Unused Dependencies_ utility, which is available from the Dependencies page of PDE's manifest editor (context menu or expand the _Dependency Analysis_ section).
> > Another way to manage the plugin manifest is to use the _Organize Manifests_ wizard (see [help file](http://help.eclipse.org/galileo/topic/org.eclipse.pde.doc.user/guide/tools/pde_actions/organize_manifests.htm?resultof=%22%70%6c%75%67%69%6e%22%20%22%64%65%70%65%6e%64%65%6e%63%69%65%73%22%20%22%64%65%70%65%6e%64%22%20)).
> > Finally if you wonder why a dependency is needed you can use the _Compute Dependency Extent_ operation found on the context menu.
  1. **Review feature plugin manifest**
> > Same as above except the _Compute_ button next to the dependencies is the preferred way to maintain this list.
  1. **Check list of previous builds**
> > Any jars from previous builds left in the plugins and features directories will also be included in the site content. Therefore before starting a build it might be necessary to remove some of the previously built jars otherwise the update site can grow quickly in size. **Caution**: do not delete the plugins and features directory as this will also delete the .svn directories which contains the subversion repository information (you will not be able to check back in your changes if they're gone).
## 2. Step for eclipse [bug 286709](https://code.google.com/p/eclihx/issues/detail?id=86709) ##
[Eclipse bug 2867809](https://bugs.eclipse.org/bugs/show_bug.cgi?id=286709) is an annoying bug when building update sites. It basically makes the category disappear from the _Install New Software..._ window. The workaround is to remove the eclihx.feature feature and add it again under the EclihX category. This must be done before pressing the _Build All_ button.
## 3. Build the update site ##
Just press the _Build All_ button on the site.xml editor.
## 4. Test the new build ##
Before checking in the changes to the update site it's always best to test it locally. It's possible to define an update site based on a local directory. Simply use the _Help > Install New Software..._ wizard to do so.
## 5. Check-in the changes in the updates directory ##
The update site address points directly to the svn repository. Checking-in the changes will make them available to the outside world and will trigger update notifications.

# Going further + other useful resources #

  * [JAR signing](http://wiki.eclipse.org/JAR_Signing): this will remove the warning when updating EclihX from the update site.
  * Obviously it would be great to have a nightly build on some server. This would mean two update sites: one for users manually maintained, and one for developers with nightly builds.
  * [Creating an Eclipse Update Site with Source Code](http://nolacoaster.livejournal.com/115522.html)